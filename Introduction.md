### 定义

**分布式系统（Distributed System）** 是一组表现如单机系统的计算单元。首先，不同计算单元是独立运行的，既可以是硬件设备，也可以是软件。它们被称为 **节点（node）** 。其次，对于用户来说，与分布式系统进行交互的体验如同在单机系统上操作一般。

### 特点

#### 1. 自治的计算节点集群

分布式系统中的计算节点是互相独立的，每个单独节点都可以独立计算。除此之外，这也意味着分布式节点中没有统一的 **全局时钟**，这为同步与协调节点带来挑战。

同时，管理 **群组成员** 也是一个重要的任务。在一个 **开放群组（open group）**  中，任何节点都可以加入到群组中；而在 **关闭群组（close group）** 中，只有组内成员能够互相交流。权限控制意味着分布式系统需要具备鉴权（authenticate）节点的功能，同时每个节点必须能够知道另一个节点是否在系统的群组内部。

实践中，分布式网络常常是一个 **覆盖网络（overlay network）**。例如 **P2P** 网络。

>**Structured overlay**: In this case, each node has a well-defined set of neighborswith whom it can communicate. For example, the nodes are organizedin a tree or logical ring.

>**Unstructured overlay**: In these overlays, each node has a number of refer-ences to randomly selected other nodes.

#### 2. 单一连续的系统

分布式系统应当“表现得”如同一个单一的、连续的系统。例如用户不应当知道任务在那个计算单元上执行，或者数据被存储在系统中的哪个节点上，这被称为 “ **分布透明性（distribution transparency）**”。

### 中间件与分布式系统

分布式系统的一个常用方式是作为 **中间件** 为分布式应用提供服务。

![[Pasted image 20231129214400.png]]

中间件为单独的分布式应用提供了与其他应用通信的能力，同时隐藏了操作系统的细节。它提供了一些功能，如：

1. 资源管理
2. 应用间通信
3. 跟踪和记录资源使用情况
4. 隐藏与恢复异常

中间件可以被视为常用组件与功能的容器，常用的中间件服务有：
1. 通信，例如 **Remote Procedure Call（RPC）**。RPC服务允许一个应用调用远程电脑上的功能，如同本地调用一般。开发者只需要使用特定编程语言规定函数头即可。
2. **事务**。事务允许一系列服务“要不全部执行，要不全部不执行”。


### 设计目标

分布式系统有一些设计目标。首先，用户需要非常方便的 **获取与共享远程资源**。这些资源包括存储、外围设备、数据、文件、服务、网络等。基于此，分布式系统可以提供诸如网络会议、P2P文件共享等服务。

其次，系统需要提供分布透明性，具体来说就是使得“进程”与“资源”对用户不可见，下面用 **对象（object）** 来指代。透明性涉及到几个方面，

| 透明性                     | 描述                                           |
| -------------------------- | ---------------------------------------------- |
| 访问透明性（Access）       | 隐藏数据的表现形式，以及如何获取对象的细节         |
| 位置透明性（Location）     | 隐藏对象的实际位置                             |
| 重定位透明性（Relocation） | 对象位置的变化不影响对外暴露的路由             |
| 迁移透明性（Migration）    | 当一个组件或服务移动位置时，用户不会感知到     |
| 复制透明性（Replication）  | 假如系统中数据存在重复存储，用户不会感知到     |
| 并发透明性（Concurrency）  | 隐藏对象被共享的事实                           |
| 失败透明性（Failure）      | 当对象操作出现失败时，向用户隐藏并提供恢复机制 |

**访问透明性（Access Transparency）** 隐藏数据表示以及获取数据的细节。分布式系统不仅要隐藏不同机器上操作系统的细节，而且希望在数据的表示是相同的，包括但不限于文件命名系统、文件操作、进程通信方式。**位置透明性（Location Transparency）** 希望用户无法得知对象在系统中的物理位置，常常会为系统中的对象另外赋予逻辑上面的名称，例如URL。同时，URL也提供了 **重定位透明性（Relocation Transparency）**，即使对象的位置（如`index.html`）的位置在服务器中移动了，用户也无法得知。

**迁移透明性（Migration Transparency）** 的含义为：用户资源的变化不影响正在进行的通信与操作。例如无论用户使用什么设备在什么位置使用IM通信，都不影响通信内容。**复制透明性（Repilication Transparency）** 基于这样一个前提：分布式系统中文件的重复是有益的，例如本地代理复制的网络资源可以节约向外网请求的流量与响应时间。它意味着存在多个相同的资源，甚至是进程（为了程序的健壮性考虑），而用户本身不会感觉到。

既然分布式系统的一大用处是资源共享，那么一个资源很有可能同时被多个用户请求。用户感觉不到资源的共享被称为 **并发透明性（Concurrency Transparency）**。此时资源需要保持一致性，这意味着需要一些另外的机制，来保证。**失败一致性（Failure Concurrency）** 指系统部分节点的失效不会被用户感知，且系统能很快从失效中恢复。难点在于区分死亡的进程与运行缓慢的进程。

#### 透明性的限度

并非总是需要向用户隐藏一切细节。有些细节是无法隐藏的，如网络延时；同时，高度的透明化可能带来性能影响。总之，透明的程度是需要慎重考虑的，未必越高越好。

#### 开放性

分布式系统需要是开放的，这意味着系统需要提供易于集成的组件，也由组件构成。

开放性意味着组件间需要遵循一定的规约，对自己提供的功能在语法语义上有所约定。一种规定服务的方式是通过 **接口（Interface）** 使用 **接口定义语言（Interface Definition Language, IDL）**。IDL规范了接口语法，包括函数名、翻出、返回值、可能的异常等。但规定语义可能是更加困难的，一般只能用自然语言描述。

接口的意义在于，遵循接口的双方可以通信而不必在意彼此内部的细节。同时，也存在对相同接口不同实现的组件。

接口的定义应当是完备的，虽然很难做到。完备的定义是：**互操作性（Interoperability）**，即两个实现统一接口的组件可以互相操作，即使实现者并不相同；**可移植性**，指实现接口后的组件在不同平台上（同样实现了对应接口）都可以正常工作。

同时，我们希望系统的组件是可自由添加或去除的，这代表系统应当有 **扩展性**。在此基础上，我们不仅需要设计不同节点之间的通信接口，也需要设计组件之间的通信接口。
#### 可伸缩性

可伸缩性分为以下几个方面

1. **规模可伸缩性（Size scalability）**：系统可以根据规模伸缩，即用户或资源可以轻易添加到系统中，而不会带来显著的性能损失。
2. **地理可伸缩性（Geographical scalability）**：地理位置的分布不同不影响系统表现
3. **管理可伸缩性（Administrative scalability）**：是指即使系统不断扩大，管理系统的成本与复杂性依然能得到有效控制。

